@page "/Register"
@rendermode InteractiveServer
@using Blazored.LocalStorage
@using Blazored.LocalStorage.StorageOptions
@using NEA.Components.Layout
@using System.Threading.Tasks
@inject DatabaseService Db
@inject NavigationManager NavMenu

<PageTitle>Register </PageTitle>
<InputText @bind-Value="username" placeholder="Username"/>
<InputText @bind-Value="password" placeholder="Username"/>
<button type="button"@onclick="RegisterUser">Register</button>
<button type="button" @onclick="Cancel">Cancel</button>
<p>@error</p>

@code{
    [Inject] ILocalStorageService storageService { get; set;}
    private string error;
    private string username;
    private string password;
    private async Task RegisterUser(){
        username = username.Trim();
        password = password.Trim();
        var success = await Db.RegisterUserAsync(username, password);
        if(success){
            var user = await Db.LoginUserAsync(username,password);
            if(user != null){
                await storageService.SetItemAsync("currentUser", user);
                error = "Login Sucessful!";
                NavMenu.NavigateTo("/");
                }
            else{
                error = "Invalid Login";
            
            }
            }
        }
    private void Cancel(){
        NavMenu.NavigateTo("/");
    }
}